{% extends "base.html" %}
{% block content %}

<!-- Page title -->
<h2 style="margin-bottom: 1rem; font-weight:600;">ðŸ“‹ All Tasks</h2>

<!-- Message container -->
<div id="message"></div>

<!-- Tasks table card -->
<div class="card fluid" style="padding:0;">
  <table class="striped" style="width:100%; border-radius:8px; overflow:hidden;">
    <thead style="background:#2b2d42; color:white;">
      <tr>
        <th>#</th>
        <th>Title</th>
        <th>Description</th>
        <th>Due Date</th>
        <th>Status</th>
        <th style="text-align:center;">Actions</th>
      </tr>
    </thead>
    <tbody id="tasks-body"></tbody>
  </table>
</div>

<!-- Styles for badges and buttons -->
<style>
  .badge.success {
      background: #2ecc71;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
  }
  .badge.warning {
      background: #f1c40f;
      color: black;
      padding: 4px 8px;
      border-radius: 4px;
  }
  .button.small {
      padding: 2px 8px !important;
      font-size: 0.8rem;
      border-radius: 4px;
  }
  .button.secondary {
      background: #e63946 !important;
      color: white !important;
  }
  .button.secondary:hover {
      background: #cc2e3b !important;
  }
</style>

<script>
// ----------------------
// Load all tasks from API
// ----------------------
async function loadTasks() {
    try {
        const res = await fetch('/api/tasks/');
        const tasks = await res.json();

        const tbody = document.getElementById('tasks-body');
        tbody.innerHTML = '';

        // Show message if no tasks
        if (tasks.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align:center; padding:20px; color:#555;">
                        No tasks found.
                    </td>
                </tr>`;
            return;
        }

        // Add rows for each task
        for (const t of tasks) {
            const tr = document.createElement('tr');

            const statusText = t.status === "completed" ? "Completed" : "Pending";
            const statusBadge = t.status === "completed"
                ? `<span class="badge success">${statusText}</span>`
                : `<span class="badge warning">${statusText}</span>`;

            tr.innerHTML = `
                <td>${t.display_id}</td>
                <td>${t.title}</td>
                <td>${t.description || '-'}</td>
                <td>${t.due_date || '-'}</td>
                <td>${statusBadge}</td>
                <td style="text-align:center;">
                    <a class="button small" href="/edit/${t.id}/">Edit</a>
                    <a class="button small secondary" href="#" onclick="deleteTask(${t.id}); return false;">Delete</a>
                </td>
            `;
            tbody.appendChild(tr);
        }
    } catch (err) {
        console.error("Failed to load tasks:", err);
    }
}

// ----------------------
// Delete a task by id
// ----------------------
async function deleteTask(id) {
    if (!confirm("Are you sure you want to delete this task?")) return;

    const res = await fetch(`/api/tasks/delete/${id}/`, { method: "DELETE" });

    if (res.ok) {
        loadTasks(); // Refresh task list
    } else {
        alert("Failed to delete task.");
    }
}

// Load tasks on page load
window.onload = loadTasks;
</script>

{% endblock %}
